#! /bin/bash -e
# Link to files in the home folder
BASE=$(cd ${0%/*} && pwd -P)

function link() {
    local source=$1
    local target=$2

    ( [ -L $target ] || [ ! -f $target ] ) || {
        echo "'$target' exists and is not a link, skipping";
        continue;
    }

    mkdir -p $(dirname $target)
    ln --symbolic --force --no-target-directory \
        "${BASE}/$source" $target
}

# Copy dot-files
for SRC in $(find src -type f)
do
    TARGET="$HOME/.${SRC#src/}"
    link $SRC $TARGET
done

# Copy scripts to ~/bin/
for SRC in $(find bin lib -type f)
do
    TARGET="$HOME/.local/$SRC"
    link $SRC $TARGET
done

vi_target=$HOME/.local/bin/vi
vi_exe=/usr/bin/vim
[ -L "$vi_target" ] && rm "$vi_target"
[ -e "$vi_exe" ]    && ln -s "$vi_exe" "$vi_target"
