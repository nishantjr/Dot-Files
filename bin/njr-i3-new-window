#!/usr/bin/env python2

import socket
import subprocess
import struct
import json

from itertools import chain

i3 = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)
tree = json.loads(subprocess.check_output(['i3-msg', '-t', 'get_tree']))

def relationize(tree):
    ret = []
    for node in tree['nodes']:
       node['parent'] = tree['id']
       ret += relationize(node)
    del tree['nodes']
    ret.append(tree)
    return ret

flattened = relationize(tree)
focused = filter(lambda x: x['focused'], flattened)

if len(focused) == 0:
    print stderr, "No window focused!"
    exit()
focused = focused[0]

print 'ID: ', focused['id']
print 'Container ID: ', focused['parent']
print 'Window: ', focused['window']
